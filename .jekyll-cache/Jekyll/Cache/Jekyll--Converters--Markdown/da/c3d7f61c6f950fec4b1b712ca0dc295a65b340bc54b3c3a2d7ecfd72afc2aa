I"f<h1 id="1-케이블의-앞은-lan-기기였다">1. 케이블의 앞은 LAN 기기였다</h1>
<h3 id="케이블과-리피터-허브-속을-신호가-흘러간다">케이블과 리피터, 허브 속을 신호가 흘러간다</h3>
<ul>
  <li>패킷의 헤더에 기록된 제어 정보로 목적지를 판단해 목적지로 패킷을 중계</li>
  <li>내부의 데이터 부분은 보지 않고 목적지 주소만 보고 패킷을 중계</li>
</ul>

<p>⇒ 모든 패킷은 아무 관련도 없는 별개의 것으로 간주하고 목적지를 향해 중계됨</p>

<h3 id="라우터의-패킷-중계-동작">라우터의 패킷 중계 동작</h3>
<ul>
  <li>라우터 = 중계 부분 + 포트 부분
    <ol>
      <li>중계 부분 : 패킷의 중계 대상을 판단하는 동작을 담당 (like IP 담당 부분)</li>
      <li>포트 부분 : 패킷을 송수신하는 동작을 담당 (like LAN 어댑터)</li>
    </ol>
  </li>
  <li>라우터의 각 포트에는 <strong>MAC 주소와 IP 주소</strong>가 할당되어 있음
    <ol>
      <li>IP주소
        <ul>
          <li>라우터는 IP 주소로 중계 대상을 판단</li>
          <li><strong>라우팅 테이블</strong> (경로표) : 라우팅 테이블의 수신처의 정보(IP주소)와 수신한 패킷의 수신처 IP 주소를 비교하여 패킷을 중계</li>
        </ul>
      </li>
      <li>MAC주소
        <ul>
          <li>라우터는 자신의 MAC주소에 해당하는 패킷만 수신하고 해당하지 않는 패킷은 폐기</li>
          <li>수신이 끝나면 맨 앞의 MAC 헤더를 제거</li>
        </ul>
      </li>
    </ol>
  </li>
  <li>라우터의 경로표에서 넷마스크 항목이 0.0.0.0인 행은 기본 경로를 나타냄</li>
</ul>

<blockquote>
  <p>통신 <strong>상대까지 패킷을 전달하는 전체의 동작은 IP</strong>(라우터)가 담당하고, 이 동작을 할 때 <strong>다음 라우터까지 패킷을 운반하는 부분은 이더넷</strong>(스위칭 허브)가 담당</p>
</blockquote>

<h1 id="2-라우터의-부가-기능">2. 라우터의 부가 기능</h1>
<ul>
  <li>라우터의 주요 두 가지 기능 : <strong>주소 변환, 패킷 필터링</strong></li>
</ul>

<h3 id="1-주소-변환">1. 주소 변환</h3>
<ul>
  <li>주소 변환 : 패킷을 중계할 때 IP헤더에 기재된 <strong>IP주소와 포트번호를 바꿔쓰는 것</strong></li>
</ul>

<ol>
  <li>private IP : 어떤 그룹 내에서만 사용하는 IP 주소
    <ul>
      <li>특별한 구조를 가진 것이 아니라 원래 퍼블릭 주소에서 사용하던 것 중 범위를 정해서 그룹 내에서만 사용하기로 약속한 것</li>
      <li>일원화하여 관리하지 않으므로 신청할 필요가 없고 누구나 자유롭게 사용 가능</li>
      <li>단, 그룹 내에서 중복은 안 됨</li>
    </ul>
  </li>
  <li>public IP ⇒ IP 부족 문제를 해결하기 위해</li>
</ol>

<ul>
  <li><strong>내부에서 외부</strong>로 액세스하는 경우</li>
</ul>

<ol>
  <li>최초로 흐르는 패킷을 중계할 때 송신처의 IP 주소를 <strong>private IP에서 public IP</strong>(주소변환장치의 인터넷측에 있는 포트에 할당된 주소)로 바꿈과 동시에 <strong>포트번호</strong>(미사용 번호를 적당히 선택하여 사용)도 바꿈</li>
  <li>바꿔쓰기 <strong>전의 private IP 주소와 포트 번호</strong>, 바꿔쓴 <strong>후의 public IP 주소와 포트번호</strong>를 한 세트로 하여 주소 변환 장치 내부의 대응표에 기록</li>
  <li>해당 패킷을 송신 후 회신 패킷이 돌아오면 회신 패킷의 수신처에서 바꿔쓴 public IP와 포트번호를 가지고 대응표에서 private IP와 포트 번호를 찾아 바꿔씀</li>
  <li>모든 데이터 송수신이 끝나고 연결 끊기 동작을 해 접속 동작이 끝나면 대응표에 등록해둔 것 삭제</li>
</ol>

<ul>
  <li>포트 번호를 바꿔쓰는 이유
    <ul>
      <li>포트 번호를 바꿔쓰지 않으면 private IP와 public IP가 1대 1로 대응해서 인터넷에 접속하는 대수만큼 public IP가 필요 ⇒ 이 점을 개선하기 위해 포트 번호 바꿔쓰기가 고안됨</li>
      <li>클라이언트 측의 포트 번호는 원래 비어있는 것이어서 무작위로 선택해도 문제 발생 X</li>
      <li>포트번호를 바꿔쓰면 한 개의 public IP를 수만 개의 private IP에 대응시킬 수 있으므로 훨씬 이용 효율이 높아짐</li>
    </ul>
  </li>
  <li><strong>외부에서 내부</strong>로 액세스하는 경우</li>
  <li>내부에서 외부로 액세스하는 경우와는 다르게 private IP와 포트 번호가 대응표에 등록되어 있지 않아 중계를 할 수 없음 ⇒ 내부에서 의도적으로 외부에 액세스하지 않는 한 외부에서 내부에 패킷을 보낼 수 없음(부정 침입 방지 효과)</li>
  <li>외부에서 내부로 액세스하려면 <strong>사전에 수동으로 대응표에 등록</strong>해두어야 함</li>
</ul>

<h3 id="2-패킷-필터링">2. 패킷 필터링</h3>
<ul>
  <li>패킷을 중계할 때 MAC 헤더, IP 헤더, TCP 헤더에 기록되어 있는 내용을 조사하여 그것이 사전에 설정한 조건에 합치되면 패킷을 중계하거나 폐기되는 동작을 실행</li>
  <li>대부분의 방화벽이나 소프트웨어는 이 원리를 이용하여 부정 침입을 방지함</li>
</ul>
:ET